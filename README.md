# Binarization-Method

В данном репозитории представлен консольный скрипт, который бинаризует изображение различными методами(Otsu, Otsu для
неравновесного случая, Niblack, многомасштабная модификация Niblack) и считает, при необходимости, метрики качества,
такие как DRD и PSNR.

### О структуре скрипта

Скрипт имеет 3 обязательных параметра:

1)
    - i путь к папке с изображениями
2)
    - o путь к папке сохранения результата
      3- t название метода бинаризации (Niblack, Otsu, Otsu_l, Niblack_multiscale)

И 7 необязательных. В них входят парметр выбора метрики,
путь до папки с эталонами и настройки параметров модели.

Пример скрипта:

  ```
  python3 main.py -i <input_dir> -o <output_dir> -t <type method> --m <DRD or PSNR> --l <path to label>
  ```

### О метриках

Для задачи бинаризации, в контекте бинаризации документов, подбор метрики является
некоторой проблемой, так как важным критерием качества является читаемость полученного
бинаризованного документа и большинство популярных метрик не совсем коррелирует с этим показателем.
Поэтому основной метрикой качества была выбрана DRD.

DRD сравнивает не сами пиксели изображения, а контекст вокруг них с некоторым весом.
Что особенно важно при бинаризации текста, так как даже различие в несколько пикселей
может сделать буквы не читаемыми. Чем меньше значение метрике тем выше качество.
Для довольно хорошо бинаризованых изображений,
значения обычно находятся в промежуке от 0 до 3. Более подробно о данной метрике
можно почитать
в [статье](https://typeset.io/pdf/distance-reciprocal-distortion-measure-for-binary-document-39dmsw96js.pdf).

Вторая выбранная метрика PSNR обычно используется для измерения качества
восстановленного изображения по сравнению с оригинальным изображением, чем выше значение
PSNR, тем лучше качество восстановленного изображения. По ней можно понять общее структурнное
различие картинок, плюс к этому она вычисляется намного быстрее DRD.

### О приложенном датасете

Датасет состоит из 9 изображений, большинство из которых были взяты из открытых датасетов.
Эталоны были полученны с помощью нейроной сети и последующей ручной обработке, поэтому
не все маски выглядят идеально.

### О алгоритмах бинаризации

**Otsu** классический глобальным метод бинаризации. Он основывается на использовании
гистограммы яркости пикселей и пытается найти пороговое значение, которое разделяет пиксели на два класса: переднего
плана (объекты интереса) и фона (фоновые пиксели).

Основные шаги алгоритма:

1) Вычисление гистограммы яркости изображения.
2) Нормализация гистограммы, чтобы получить вероятности
для каждого уровня яркости.
3) Вычисление общей дисперсии внутриклассового разброса
для всех возможных пороговых значений.
4) Выбор порога, при котором дисперсия внутриклассового разброса минимальна.

Недостатки алгоритма:

Алгоритм предполагает, что изображение состоит из двух
классов пикселей (фон и объекты), и он не всегда хорошо
справляется с бинаризацией изображений, содержащих большое
количество шума, имеющих сложные фоны или перемены в яркости изображения.
Поэтому алгоритм может выбрать неправильный порог,
что может привести к неправильной сегментации изображения.

Преимущества алгоритма:

Является простым, эффективный в случаях однородных изображений и 
не требует предварительной настройки параметров.

**Модификация критерия Otsu для неравновесного случая**, 
описанная в статье "Maximum likelihood thresholding based on 
population mixture models", направлена на улучшение алгоритма Otsu
для случаев, когда пиксели в 
изображении принадлежат к разным группам или классам, и эти классы
могут быть неравномерно представлены

Основные шаги алгоритма:

1) Разделить гистограмму изображения на две группы: переднего и заднего плана.
2) Оценить параметры каждой группы с помощью метода максимального правдоподобия, используя модель смеси распределений Гаусса (Gaussian mixture model). Параметры, которые необходимо оценить, включают средние значения и дисперсии каждой группы.
3) Рассчитать функцию правдоподобия для каждой из двух групп.
4) Рассчитать сумму функций правдоподобия для двух групп и использовать ее в качестве критерия определения порога бинаризации.
5) Найти порог бинаризации, который максимизирует критерий, определенный на шаге 4.

Преимуществом модификации является неравномерное 
представление классов, что позволяет более точно определить пороги для
каждого класса. Она может быть более устойчивой к вариациям освещения
и контрастности изображений. Но главныным недостатком остается то, что
порог глобален для всего изображения.

**Локальный метода бинаризации Niblack** описанный в Niblack W. An Introduction to Digital Image Processing 
основан на вычислении порога для каждого пикселя в изображении на 
основе его локального контекста. Контекст определяется окном заданного размера,
расположенным вокруг каждого пикселя.

Основные шаги алгоритма:

1) Разбить изображение на неперекрывающиеся блоки заданного размера.
2) Вычислить среднее значение и стандартное отклонение интенсивности пикселей в каждом блоке.
3) Для каждого пикселя вычислить пороговое значение по формуле:

        T(x, y) = m(x, y) + k * s(x, y)

        где m(x, y) - среднее значение интенсивности в блоке,
        s(x, y) - стандартное отклонение интенсивности в блоке,
        k - коэффициент, задающийся экспериментально и может принимать значения от -1 до 1. 


Преимущества метода:

Учет локальной информации: Метод Ниблэка учитывает локальную информацию
вокруг каждого пикселя при определении порога.

Устойчивость к вариации освещения: За счет учета локального контраста, пороговое значение адаптируется
к изменениям яркости и освещения, что позволяет достичь лучшей бинаризации.

Гибкая настройка параметров, позволяет настраивать под конкретное изображения.

Недостатки метода:

Чувствительность к шуму: 

Зависимость от выбора параметров: Неправильный выбор параметров

может привести к недостаточно точной или слишком агрессивной сегментации.

Ограниченная применимость к различным типам изображений:

Для изображений с низким контрастом или  сложной текстурой, метод Ниблэка может давать недостаточно т
очные результаты.

Вычислительная сложность: метод
Ниблэка вычислительно более сложным по сравнению с глобальными методами
бинаризации.

**Локальный Adaptive Multi-scale Niblack метод** учитывает
многомасштабную информацию вокруг каждого пикселя для определения порог. 
Что позволяет более точно бинарзовывать изображение. Главным минусом является 
увеличеная вычислительная сложность.

Основные шаги:

1) Разбить изображение на несколько масштабов, используя метод пирамиды изображений (image pyramids).
2) Для каждого масштаба вычислить пороговое значение по методу Ниблэка. 
3) Для каждого пикселя выбрать наилучший порог из всех вычисленных 
на различных масштабах.
4) Применить полученный порог к каждому пикселю в изображении, чтобы получить бинаризованное изображение
